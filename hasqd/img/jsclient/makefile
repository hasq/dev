# Hasq Technology Pty Ltd (C) 2013-2016

JQUID=../../ext/jq/
JQUIF=jquery-ui-1.11.4.custom
JQUI=$(JQUID)$(JQUIF)

all: makeslice makehelp jquery zxcvbn makeclient

client: makehelp jquery zxcvbn makeclient

makeslice:
	mkdir -p slice/home/css
	mkdir -p slice/home/ui
	mkdir -p slice/home/lib
	mkdir -p slice/home/lib/images
	mkdir -p slice/home/front
	mkdir -p slice/home/eng
	mkdir -p slice/home/img
	
makehelp: makehelp_tmp
	sh subster.sh < front/hq_help.tmp | sed 's/@n/\\n/' > front/hq_help.gen
	rm front/hq_help.tmp
	sh subster.sh < front/ts_help.tmp | sed 's/@n/\\n/' > front/ts_help.gen
	rm front/ts_help.tmp
	sh subster.sh < front/ts_welcome.tmp | sed 's/@n/\\n/' > front/ts_welcome.gen
	rm front/ts_welcome.tmp

makehelp_tmp: front/hq_help.inc.js front/ts_help.inc.js front/ts_welcome.inc.js txt/*.htm
	echo "////////////////////////////////////////////////////" > front/hq_help.tmp
	echo "//   THIS IS AUTOGENERATED FILE, DO NOT MODIFY    //" >> front/hq_help.tmp
	echo "////////////////////////////////////////////////////" >> front/hq_help.tmp
	echo "" >> front/hq_help.tmp
	cat front/hq_help.inc.js >> front/hq_help.tmp
	echo "////////////////////////////////////////////////////" > front/ts_help.tmp
	echo "//   THIS IS AUTOGENERATED FILE, DO NOT MODIFY    //" >> front/ts_help.tmp
	echo "////////////////////////////////////////////////////" >> front/ts_help.tmp
	echo "" >> front/ts_help.tmp
	cat front/ts_help.inc.js >> front/ts_help.tmp
	echo "////////////////////////////////////////////////////" > front/ts_welcome.tmp
	echo "//   THIS IS AUTOGENERATED FILE, DO NOT MODIFY    //" >> front/ts_welcome.tmp
	echo "////////////////////////////////////////////////////" >> front/ts_welcome.tmp
	echo "" >> front/ts_welcome.tmp
	cat front/ts_welcome.inc.js >> front/ts_welcome.tmp	
	
jquery: $(JQUI).tar.bz2
	cp $< lib/
	cd lib && make NAME=$(JQUIF)

zxcvbn: slice/home/lib/zxcvbn.js

slice/home/lib/zxcvbn.js: lib/zxcvbn.js slice/home/lib
	cp lib/zxcvbn.js slice/home/lib/

slice/home/lib:
	mkdir -p slice/home/lib
	
makeclient: index.html 
#	hqclnt
	cp css/hqclnt.css slice/home/css/
	cp eng/hq_*.js slice/home/eng/
	cp front/hq_*.js slice/home/front/
	rm -f slice/home/front/hq_help.inc.js
	mv -f front/hq_help.gen slice/home/front/hq_help.gen.js
	cp ui/hq_*.js slice/home/ui/	
	cp hqclnt.html slice/home/
#	tsclnt
	cp css/tsclnt.css slice/home/css/
	cp eng/ts_*.js slice/home/eng/
	cp front/ts_*.js slice/home/front/
	rm -f slice/home/front/ts_help.inc.js
	mv -f front/ts_help.gen slice/home/front/ts_help.gen.js
	rm -f slice/home/front/ts_welcome.inc.js
	mv -f front/ts_welcome.gen slice/home/front/ts_welcome.gen.js
	cp ui/ts_*.js slice/home/ui/
	cp tsclnt.html slice/home/tsclnt.html
#	shared
	cp front/sh_*.js slice/home/front/
	cp eng/sh_*.js slice/home/eng/
	cp img/*.gif slice/home/img/
	cp img/*.png slice/home/img/
	cp lib/jquery-ui/jquery-ui.min.js slice/home/lib/
	cp lib/jquery-ui/jquery-ui.min.css slice/home/lib/
	cp lib/jquery-ui/external/jquery/jquery.js slice/home/lib/
	cp lib/jquery-ui/images/*.png slice/home/lib/images
	cp lib/jquery-ui/external/jquery/jquery.js slice/home/lib/
	cp index.html slice/home/
#	chmod
	chmod 0777 -R slice/home || echo "Cannot make chmod on home"

clean:
	rm -rf lib/jquery* slice/home index slice lib/*.tar lib/*.tar.bz2
	rm -rf front/*.gen
	rm -rf front/*.tmp
	rm -rf front/hq_help.js
	rm -rf front/ts_help.js
	rm -rf hq.*.lock	
	
softclean:
	rm -rf lib/jquery* slice/home lib/*.tar lib/*.tar.bz2
	rm -rf front/*.gen
	rm -rf front/*.tmp
	rm -rf front/hq_help.js
	rm -rf front/ts_help.js
	
checkin:
	cp -f slice/home/front/*.js front/
	cp -f slice/home/eng/*.js eng/
	cp -f slice/home/ui/*.js ui/
	cp -f slice/home/*.html ./
	cp -f slice/home/css/*.css css/
#	
	chmod 0777 -R slice/home
